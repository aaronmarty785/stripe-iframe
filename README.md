<h1>Stripe Variable-Amount Payments (Laravel)</h1>
<p>Accept variable invoice payments (Card &amp; ACH) and automatically add Stripe fees so your business receives the full invoice amount. The page can be embedded into Webflow (or any site) via an <code>&lt;iframe&gt;</code>. No paid third-party services; only Stripe.</p> 

<h2>Features</h2><ul> <li>Variable amount + invoice number</li> <li>Automatic fee gross-up (Card: 2.9% + 30¢; ACH: 0.8% capped at $5)</li> <li>Stripe Elements for Card &amp; ACH</li> <li>Clean Bootstrap UI with live fee preview</li> <li>Embeddable page: <code>/pay</code></li> <li>No webhooks required</li> </ul> <h2>Tech Stack</h2> <ul> <li>Laravel (PHP), Stripe PHP SDK, Stripe.js</li> <li>Bootstrap 5, ES modules (no build step required)</li> </ul> <h2>Quick Start</h2> <pre><code>git clone &lt;YOUR_REPO_URL&gt; stripe-variable-pay cd stripe-variable-pay composer install

cp .env.example .env
php artisan key:generate

Edit .env (see below)

php artisan serve

http://127.0.0.1:8000/pay

</code></pre>

<h2>Configuration (.env)</h2> <pre><code>STRIPE_KEY=pk_test_xxx STRIPE_SECRET=sk_test_xxx
</code></pre>

<h2>Key Files</h2> <ul> <li><code>routes/web.php</code>: <code>GET /pay</code> (embeddable form)</li> <li><code>routes/api.php</code>: <code>POST /api/payment-intents</code> (creates PaymentIntent)</li> <li><code>app/Http/Controllers/StripePaymentController.php</code></li> <li><code>app/Services/FeeService.php</code> (server fee math)</li> <li><code>resources/views/pay.blade.php</code> (Bootstrap UI)</li> <li><code>public/js/fee.js</code> • <code>public/js/api-payment.js</code> • <code>public/js/validations.js</code> • <code>public/js/main.js</code></li> <li><code>config/stripe.php</code></li> </ul> <h2>Routes</h2> <ul> <li><strong>GET /pay</strong> — Payment form. Optional query params: <code>?logo=&lt;url&gt;</code>, <code>?title=Your%20Brand</code></li> <li><strong>POST /api/payment-intents</strong> — Body: <pre><code>{ "invoice": "INV-1001", "amount": 1200.00, "method": "card" | "ach", "customerName": "Jane Doe", "email": "jane@example.com" }</code></pre> Returns: <pre><code>{ "clientSecret": "pi_..._secret_..." }</code></pre> </li> </ul> <h2>Embedding in Webflow (or Any Site)</h2> <pre><code>&lt;iframe src="https://YOUR-DOMAIN.com/pay?logo=https%3A%2F%2Fcdn.example.com%2Flogo.png&amp;title=Pay%20Invoice" style="width:100%;max-width:780px;height:920px;border:0;"&gt;&lt;/iframe&gt; </code></pre> <p>If you use CSP, allow framing:</p> <pre><code>Content-Security-Policy: frame-ancestors 'self' https://*.webflow.io https://YOUR-DOMAIN.com; </code></pre> <h2>How Fee Gross-Up Works (Summary)</h2> <ul> <li><strong>Card:</strong> <code>gross_cents = ceil((net_cents + 30) / (1 - 0.029))</code></li> <li><strong>ACH:</strong> Fee = <code>min(ceil(gross_cents * 0.008), 500)</code>; if uncapped fee ≤ 500, solve for gross; else gross = net + 500.</li> <li>Server is authoritative; client mirrors for live preview.</li> </ul> <h2>Testing (Stripe)</h2> <ul> <li>Card: <code>4242 4242 4242 4242</code>, any future expiry/CVC.</li> <li>ACH: use Stripe test bank flow; expect <em>processing</em> status in test mode.</li> </ul> <h2>Troubleshooting</h2> <ul> <li><em>Route not found</em>: ensure <code>/pay</code> in <code>web.php</code> and <code>/api/payment-intents</code> in <code>api.php</code>.</li> <li><em>ES module export errors</em>: scripts loaded with <code>type="module"</code> and named exports match imports.</li> <li><em>IFrame blocked</em>: configure CSP <code>frame-ancestors</code>; avoid <code>X-Frame-Options: DENY</code>.</li> </ul> <h2>Deployment Notes</h2> <ul> <li>Serve <code>public/</code> as web root; set <code>APP_URL</code>, Stripe keys in <code>.env</code>.</li> <li>HTTPS recommended. No queues/webhooks needed for this PoC.</li> </ul> <h2>Time Log (≤ 6 hours)</h2> <ul> <li>Planning &amp; setup: 1.0h</li> <li>Fee service + API endpoint: 1.2h</li> <li>Blade UI + Elements integration: 1.6h</li> <li>ACH flow + messaging: 0.8h</li> <li>Embed &amp; CSP notes: 0.4h</li> <li>Docs &amp; polish: 1.0h</li> <li><strong>Total:</strong> 6.0h</li> </ul> <h2>License</h2> <p>MIT (or your preferred license).</p>
